<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GSDC Timeline Admin</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            color: #2C5AA0;
            margin: 0 0 10px 0;
        }
        
        .controls {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            background: #2C5AA0;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn:hover {
            background: #1A4180;
        }
        
        .btn-success {
            background: #22C55E;
        }
        
        .btn-success:hover {
            background: #16A34A;
        }
        
        .search-input {
            width: 100%;
            max-width: 400px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        
        .initiative-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-left: 4px solid #2C5AA0;
        }
        
        .initiative-title {
            font-size: 18px;
            font-weight: bold;
            color: #2C5AA0;
            margin-bottom: 5px;
        }
        
        .initiative-meta {
            color: #666;
            margin-bottom: 10px;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: #22C55E;
            border-radius: 4px;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background: white;
            margin: 50px auto;
            padding: 20px;
            width: 90%;
            max-width: 600px;
            border-radius: 8px;
        }
        
        .close {
            float: right;
            font-size: 24px;
            cursor: pointer;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
        }
        
        .form-group textarea {
            height: 100px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>GSDC Timeline Admin</h1>
        <p>Manage Strategic Plan Implementation Timeline</p>
    </div>

    <div class="controls">
        <input type="text" class="search-input" id="searchInput" placeholder="Search initiatives..." onkeyup="filterInitiatives()">
        <br>
        <button class="btn" onclick="addInitiative()">Add Initiative</button>
        <button class="btn btn-success" onclick="saveToGitHub()">Save to GitHub</button>
        <button class="btn" onclick="loadFromGitHub()">Load from GitHub</button>
        <a href="gsdc_timeline_display.html" class="btn" style="text-decoration: none; display: inline-block;">View Timeline</a>
    </div>

    <div id="initiativesList">
        <!-- Populated by JavaScript -->
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle">Edit Initiative</h2>
            
            <div class="form-group">
                <label>Initiative Name</label>
                <input type="text" id="editName">
            </div>
            
            <div class="form-group">
                <label>Status</label>
                <select id="editStatus">
                    <option value="not-started">Not Started</option>
                    <option value="in-progress">In Progress</option>
                    <option value="completed">Completed</option>
                    <option value="delayed">Delayed</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Progress (%)</label>
                <input type="number" id="editProgress" min="0" max="100">
            </div>
            
            <div class="form-group">
                <label>Description</label>
                <textarea id="editDescription"></textarea>
            </div>
            
            <button class="btn btn-success" onclick="saveInitiative()">Save Changes</button>
            <button class="btn" onclick="closeModal()">Cancel</button>
        </div>
    </div>

    <script>
        var githubOwner = '1979wdr-evident';
        var githubRepo = 'gsdc-timeline';
        var githubToken = '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';
        var githubFileName = 'timeline-data.json';

        var timelineData = [
            {
                id: 'p1-messaging',
                name: 'Regional Messaging Toolkit',
                status: 'not-started',
                progress: 0,
                description: 'Develop a shared set of key messages, visuals, and data points to align how partners communicate the regions identity and priorities.'
            },
            {
                id: 'p2-startup-journey',
                name: 'Startup Journey Map & Mentorship',
                status: 'in-progress',
                progress: 25,
                description: 'Clarify the idea-to-exit business growth path and launch a structured mentorship network.'
            },
            {
                id: 'p3-roi-dashboard',
                name: 'Quarterly ROI Dashboard & Video Briefings',
                status: 'in-progress',
                progress: 20,
                description: 'Deliver investor updates through a lightweight, consistent format that is visual, digestible, and usable.'
            }
        ];

        var currentEditingId = null;

        function renderInitiatives() {
            var container = document.getElementById('initiativesList');
            var searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            var filteredData = timelineData.filter(function(item) {
                return item.name.toLowerCase().includes(searchTerm) || 
                       item.description.toLowerCase().includes(searchTerm);
            });
            
            var html = '';
            for (var i = 0; i < filteredData.length; i++) {
                var item = filteredData[i];
                html += '<div class="initiative-card">';
                html += '<div class="initiative-title">' + item.name + '</div>';
                html += '<div class="initiative-meta">Status: ' + item.status + ' | Progress: ' + item.progress + '%</div>';
                html += '<div class="progress-bar"><div class="progress-fill" style="width: ' + item.progress + '%"></div></div>';
                html += '<p>' + item.description + '</p>';
                html += '<button class="btn" onclick="editInitiative(\'' + item.id + '\')">Edit</button>';
                html += '</div>';
            }
            
            container.innerHTML = html;
        }

        function filterInitiatives() {
            renderInitiatives();
        }

        function addInitiative() {
            currentEditingId = null;
            document.getElementById('modalTitle').textContent = 'Add New Initiative';
            document.getElementById('editName').value = '';
            document.getElementById('editStatus').value = 'not-started';
            document.getElementById('editProgress').value = '0';
            document.getElementById('editDescription').value = '';
            document.getElementById('editModal').style.display = 'block';
        }

        function editInitiative(id) {
            var initiative = null;
            for (var i = 0; i < timelineData.length; i++) {
                if (timelineData[i].id === id) {
                    initiative = timelineData[i];
                    break;
                }
            }
            
            if (!initiative) return;
            
            currentEditingId = id;
            document.getElementById('modalTitle').textContent = 'Edit Initiative';
            document.getElementById('editName').value = initiative.name;
            document.getElementById('editStatus').value = initiative.status;
            document.getElementById('editProgress').value = initiative.progress;
            document.getElementById('editDescription').value = initiative.description;
            document.getElementById('editModal').style.display = 'block';
        }

        function saveInitiative() {
            var name = document.getElementById('editName').value;
            var status = document.getElementById('editStatus').value;
            var progress = parseInt(document.getElementById('editProgress').value);
            var description = document.getElementById('editDescription').value;
            
            if (!name) {
                alert('Please enter a name');
                return;
            }
            
            if (currentEditingId) {
                for (var i = 0; i < timelineData.length; i++) {
                    if (timelineData[i].id === currentEditingId) {
                        timelineData[i].name = name;
                        timelineData[i].status = status;
                        timelineData[i].progress = progress;
                        timelineData[i].description = description;
                        break;
                    }
                }
            } else {
                var newId = 'custom-' + Date.now();
                timelineData.push({
                    id: newId,
                    name: name,
                    status: status,
                    progress: progress,
                    description: description
                });
            }
            
            closeModal();
            renderInitiatives();
        }

        function closeModal() {
            document.getElementById('editModal').style.display = 'none';
            currentEditingId = null;
        }

        function saveToGitHub() {
            var url = 'https://api.github.com/repos/' + githubOwner + '/' + githubRepo + '/contents/' + githubFileName;
            
            // First get the current file to get the SHA
            fetch(url, {
                headers: {
                    'Authorization': 'token ' + githubToken,
                    'Accept': 'application/vnd.github.v3+json'
                }
            })
            .then(function(response) {
                if (response.ok) {
                    return response.json();
                } else {
                    return null;
                }
            })
            .then(function(fileData) {
                var sha = fileData ? fileData.sha : null;
                var jsonData = JSON.stringify(timelineData, null, 2);
                var content = btoa(unescape(encodeURIComponent(jsonData)));
                
                var requestBody = {
                    message: 'Update timeline data - ' + new Date().toISOString(),
                    content: content,
                    branch: 'main'
                };
                
                if (sha) {
                    requestBody.sha = sha;
                }
                
                return fetch(url, {
                    method: 'PUT',
                    headers: {
                        'Authorization': 'token ' + githubToken,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });
            })
            .then(function(response) {
                if (response.ok) {
                    alert('Timeline data saved to GitHub successfully!');
                } else {
                    alert('Failed to save to GitHub');
                }
            })
            .catch(function(error) {
                alert('Error saving to GitHub: ' + error.message);
            });
        }

        function loadFromGitHub() {
            var url = 'https://api.github.com/repos/' + githubOwner + '/' + githubRepo + '/contents/' + githubFileName;
            
            fetch(url, {
                headers: {
                    'Authorization': 'token ' + githubToken,
                    'Accept': 'application/vnd.github.v3+json'
                }
            })
            .then(function(response) {
                if (response.ok) {
                    return response.json();
                } else {
                    throw new Error('File not found');
                }
            })
            .then(function(fileData) {
                var content = atob(fileData.content);
                timelineData = JSON.parse(content);
                renderInitiatives();
                alert('Timeline data loaded from GitHub successfully!');
            })
            .catch(function(error) {
                alert('Error loading from GitHub: ' + error.message);
            });
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            var modal = document.getElementById('editModal');
            if (event.target == modal) {
                closeModal();
            }
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            renderInitiatives();
        });
    </script>
</body>
</html>
